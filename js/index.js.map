{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/remote_key_map.js","webpack:///./src/js/data_store.js","webpack:///./src/js/hero.js","webpack:///./src/js/phaser_wrapper.js","webpack:///./src/js/story_line.js","webpack:///./node_modules/store2/dist/store2.js","webpack:///./src/js/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","KEY_MAP","REV_KEY_MAP","_hasOwnProperty","obj","_","callbacks","fn","this","set","callback","undefined","push","_DATASTORE_API_URL","_REMOTE_STORE_CACHE","namespace","AnswerStore","RemoteStore","_tokenChecked","response","fetch","method","data","json","token","expireTime","Date","getTime","has","_register","ok","_ensureToken","console","log","url","_inc","_getc","result","localKey","count","getCount","Char","phaser","id","x","y","texture","frame","Number","isNaN","_name","messages","messageBox","makeContainer","player","physics","add","sprite","setSize","setOffset","setDepth","text","font","fill","align","setOrigin","setStroke","newName","setText","message","Infinity","enable","addMessage","clearMessage","now","end","slice","time","delta","setX","setY","length","_removeOutdatedMessage","backgroundColor","jointMessage","setVisible","destroy","super","dest","setTexture","setFrame","update","Math","hypot","minGap","max","speed","setVelocity","setVelocityX","setVelocityY","_RE_PLAYER","charDaemon","chars","error","char","dialogs","hasOnGoingDialog","dialogToTrigger","dialog","missionStep","title","description","bootbox","alert","dialogId","iterator","item","getCurrentDialogItem","doneDialog","me","getChar","talker","replace","content","line","nextDialogItem","showDialog","question","inputOptions","idx","choices","prompt","inputType","onEscape","backdrop","style","size","centerVertical","closeButton","onShown","iframe","document","getElementById","onHidden","recordKey","setAndNotify","increase","mission","remove","recordDone","nextStepKey","nextStep","steps","where","loc","warn","tuple","getDialog","info","moveTo","getIterator","shift","locationId","npcId","npc","step","showMissionMark","storyLineDaemon","dialogDaemon","storyLine","missionWithDependencies","listen","missionId","isReady","_addToDialogDaemon","firstStep","window","mapObjects","CreateGame","tilemapTiledJSON","storylineJSON","connection","npcList","postBootCallback","WINDOW_WIDTH","innerWidth","WINDOW_HEIGHT","innerHeight","cursors","config","type","Phaser","AUTO","width","height","parent","pixelArt","default","arcade","gravity","scene","preload","load","setPath","image","atlas","map","make","tilemap","tileset","addTilesetImage","belowLayer","createStaticLayer","worldLayer","aboveLayer","setCollisionByProperty","collides","objectLayer","getObjectLayer","objects","forEach","setPhaser","point","home","group","setImmovable","collider","clearAll","then","init","e","anims","frames","generateFrameNames","prefix","start","zeroPad","frameRate","repeat","camera","cameras","main","startFollow","setBounds","widthInPixels","heightInPixels","input","keyboard","createCursorKeys","addKey","Input","Keyboard","KeyCodes","ENTER","on","event","findNearbyDialog","startDialog","$","css","padding","setScrollFactor","once","world","createDebugGraphic","graphics","setAlpha","renderDebug","tileColor","collidingTileColor","Display","Color","faceColor","limit","center_x","position","left","center_y","top","tap","preventDefault","touch","originalEvent","targetTouches","delta_x","pageX","delta_y","pageY","min","abs","isDown","right","up","down","checkDialogToTrigger","prevVelocity","body","velocity","clone","normalize","scale","play","stop","postBoot","Game","Mission","depend","clause","expr","expectedValue","Array","_checkClause","dict","filter","String","stepId","MissionStep","fromDict","addStep","Dialog","dialogItems","dialogIdMap","dialogItem","DialogIterator","list","DialogItem","addDialogItem","currentIndex","answer","nextIndex","nextLine","DialogItemSelect","DialogItemPrompt","storeKey","DialogItemLine","DialogItemMessage","DialogItemIframe","async","loadStoryLine","fileName","missions","loadedMissions","missionDict","debug","loadStoryLineFromObject","define","version","areas","apis","inherit","api","getOwnPropertyDescriptor","stringify","JSON","parse","revive","storeAPI","area","getItem","string","setItem","removeItem","clear","Store","store","overwrite","arguments","getAll","transact","each","setAll","_id","_area","storage","_ns","singleArea","substring","isFake","toString","_in","keys","_out","fillList","k","v","alt","fillObj","all","val","ret","changed","concat","indexOf","storageAPI","items","localStorage","local","sessionStorage","amd","conflict","click","showHint"],"mappings":"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","file":"js/index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","// Generated by gen_remote_key_map.py\n\nexport const KEY_MAP = {\"0000000001\":\"MISSION/intro/step-1/done\",\"0000000002\":\"MISSION/receive-package/step-1/done\",\"0000000003\":\"RESPONSE/player_occupation/學生\",\"0000000004\":\"RESPONSE/player_occupation/工程師\",\"0000000005\":\"RESPONSE/player_occupation/律師\",\"0000000006\":\"RESPONSE/player_occupation/健身教練\",\"0000000007\":\"RESPONSE/player_occupation/中年職業婦女\",\"0000000008\":\"RESPONSE/player_occupation/記者\",\"0000000009\":\"MISSION/receive-package/step-2/done\",\"0000000010\":\"MISSION/student-scene-intro/step-1/done\",\"0000000011\":\"MISSION/student-scene-intro/step-2/done\",\"0000000012\":\"MISSION/student-scene-intro/step-3/done\",\"0000000013\":\"RESPONSE/student-intro-choice/passive\",\"0000000014\":\"RESPONSE/student-intro-choice/proactive\",\"0000000015\":\"MISSION/student-scene-academic-affairs-office/step-1/done\",\"0000000016\":\"RESPONSE/student_asked_followup_question/false\",\"0000000017\":\"RESPONSE/student_asked_followup_question/true\",\"0000000018\":\"MISSION/student-scene-department-office/step-1/done\",\"0000000019\":\"MISSION/student-scene-home-2/step-1/done\",\"0000000020\":\"MISSION/student-scene-home-2/step-2/done\",\"0000000021\":\"MISSION/student-scene-home-2/step-3/done\",\"0000000022\":\"RESPONSE/student-gene-interested-in/gene\",\"0000000023\":\"RESPONSE/student-gene-interested-in/system\",\"0000000024\":\"MISSION/student-scene-home/step-1/done\",\"0000000025\":\"MISSION/student-scene-home/step-2/done\",\"0000000026\":\"MISSION/student-scene-home/step-3/done\",\"0000000027\":\"MISSION/student-scene-home/workshop-ready/done\",\"0000000028\":\"MISSION/digit-gene-workshop/step-1/done\",\"0000000029\":\"MISSION/digit-gene-workshop/step-2/done\",\"0000000030\":\"MISSION/digit-gene-workshop/step-3/done\",\"0000000031\":\"MISSION/digit-gene-workshop/step-4/done\"};\n\nexport const REV_KEY_MAP = {};\nfor (const key in KEY_MAP) {\n  REV_KEY_MAP[KEY_MAP[key]] = key;\n}\n","/*\n * Remember some key-value pairs locally and or remotely.\n *\n * 1. localStorage: use window.localStorage to store something across browser\n *    section.\n * 2. remoteStorage: use g0v backend to store data remotely.\n *\n * For (2), we will generate an 'datastore_token', which is saved in\n * localStorage, on remoteStorage, different datastore_token means a different\n * identity.\n */\n\nimport StoreModule from 'store2';\nimport {KEY_MAP, REV_KEY_MAP} from './remote_key_map.js';\n\nfunction _hasOwnProperty(obj, property) {\n  return Object.prototype.hasOwnProperty.call(obj, property);\n}\n\n(function(_) {\n  const callbacks = [];\n\n  _.fn('setAndNotify', function(key, value) {\n    this.set(key, value);\n\n    if (!this.callbacks) return;\n\n    if (_hasOwnProperty(this.callbacks, key)) {\n      for (const callback of this.callbacks[key]) {\n        callback.call(this, key);\n      }\n    }\n\n    if (_hasOwnProperty(this.callbacks, '*')) {\n      for (const callback of this.callbacks['*']) {\n        callback.call(this, key);\n      }\n    }\n  });\n\n  _.fn('notify', function() {\n    for (const key in callbacks) {\n      if (_hasOwnProperty(this.callbacks, key)) {\n        for (const callback of this.callbacks[key]) {\n          callback.call(this);\n        }\n      }\n    }\n  });\n\n  _.fn('listen', function(key, callback) {\n    if (this.callbacks === undefined) {\n      this.callbacks = {};\n    }\n\n    if (this.callbacks[key] === undefined) {\n      this.callbacks[key] = [];\n    }\n\n    this.callbacks[key].push(callback);\n  });\n})(StoreModule._);\n\n\nconst _DATASTORE_API_URL = 'https://pingtung-hao-305236.middle2.me';\nconst _REMOTE_STORE_CACHE = StoreModule.namespace('REMOTE_STORE_CACHE');\n\nclass RemoteStoreClass {\n  constructor() {\n    // have we checked our token in current session?\n    this._tokenChecked = false;\n  }\n\n  get token() {\n    return _REMOTE_STORE_CACHE.get('token');\n  }\n\n  async _register() {\n    const response = await fetch(`${_DATASTORE_API_URL}/register`, {\n      method: 'POST',\n      // mode: 'no-cors',\n    });\n    const data = await response.json();\n    if (data.token) {\n      _REMOTE_STORE_CACHE.set('token', data.token);\n      // expire in one day.\n      const expireTime = (new Date()).getTime() + 86400 * 1000;\n      _REMOTE_STORE_CACHE.set('expire', expireTime);\n      this._tokenChecked = true;\n    }\n  }\n\n  /*\n   * Makes sure there is a valid token.\n   */\n  async _ensureToken() {\n    if (!_REMOTE_STORE_CACHE.has('token')) {\n      return await this._register();\n    }\n\n    const now = (new Date()).getTime();\n    if (now > _REMOTE_STORE_CACHE.get('expire', 0)) {\n      return await this._register();\n    }\n\n    // the token should not be expired yet, but let's check for sure.\n    if (!this._tokenChecked) {\n      const token = this.token;\n      const response = \n        await fetch(`${_DATASTORE_API_URL}/check_token?token=${token}`, {\n          method: 'GET',\n          // mode: 'no-cors',\n        });\n\n      const data = await response.json();\n      if (data.ok !== true)  {\n        return await this._register();\n      }\n\n      this._tokenChecked = true;\n    }\n  }\n\n  async _inc(key) {\n    await this._ensureToken();\n\n    console.log(`increasing key: ${key}`);\n    // now this.token is available.\n    const url = `${_DATASTORE_API_URL}/inc?token=${this.token}&key=${key}`;\n    const response = await fetch(url, {\n      method: 'POST',\n      // mode: 'no-cors',\n    });\n    const data = await response.json();\n    console.log(`increased key: ${key} -> ${data.value}, data: `, data);\n    return data.value;\n  }\n\n  async _getc(key) {\n    await this._ensureToken();\n\n    // now this.token is available.\n    const url = `${_DATASTORE_API_URL}/getc?token=${this.token}&key=${key}`;\n    const response = await fetch(url, {\n      method: 'GET',\n      // mode: 'no-cors',\n    });\n    const data = await response.json();\n    return data.value;\n  }\n\n  increase(key) {\n    key = REV_KEY_MAP[key];\n    return this._inc(key);\n  }\n\n  getCount(key) {\n    key = REV_KEY_MAP[key];\n    return this._getc(key);\n  }\n\n  async getAllCount() {\n    const result = {};\n    for (const key in KEY_MAP) {\n      const localKey = KEY_MAP[key];\n      const count = await this.getCount(localKey);\n      result[localKey] = count;\n    }\n    return result;\n  }\n}\n\nexport const AnswerStore = StoreModule.namespace('DIALOG_ANSWER');\nexport const RemoteStore = new RemoteStoreClass();\n","import * as Const from './const.js';\nimport * as StoryLine from './story_line.js';\nimport * as DataStore from './data_store.js';\nimport * as PhaserWrapper from './phaser_wrapper.js';\n\nexport class Char {\n  constructor(phaser, id, name, x, y, texture, frame) {\n    this.phaser = phaser;\n    if (Number.isNaN(x)) x = 0;\n    if (Number.isNaN(y)) y = 0;\n    this.id = id;\n    this.x = x;\n    this.y = y;\n    this._name = name;\n    this.texture = texture;\n    this.frame = frame;\n    this.messages = [];\n    this.messageBox = null;\n\n    this.makeContainer();\n  }\n\n  makeContainer() {\n    // Create a sprite with physics enabled via the physics system. The image\n    // used for the sprite has a bit of whitespace, so I'm using setSize &\n    // setOffset to control the size of the player's body.\n    this.player = this.phaser.physics.add.sprite(\n      this.x, this.y, this.texture, this.frame)\n      .setSize(32, 40)\n      .setOffset(0, 24);\n\n    this.player.setDepth(2);\n\n    this.text = this.phaser.add.text(this.x, this.y, this.name, {\n      font: '18px monospace',\n      fill: '#fff',\n      align: 'center',\n    }).setOrigin(0.5).setStroke('#000', 3).setDepth(1);\n  }\n\n  get WIDTH() {\n    return 32;\n  }\n\n  get HEIGHT() {\n    return 32;\n  }\n\n  get SPEED() {\n    return 256;\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  set name(newName) {\n    this._name = newName;\n    this.text.setText(this.name);\n  }\n\n  addMessage(message, expireTime) {\n    if (expireTime === undefined) expireTime = Infinity;\n    this.messages.push({message, expireTime});\n  }\n\n  clearMessage() {\n    this.messages = [];\n  }\n\n  showMissionMark(enable) {\n    if (enable) {\n      this.addMessage('!');\n    } else {\n      this.clearMessage();\n    }\n  }\n\n  _removeOutdatedMessage() {\n    const now = (new Date()).getTime();\n    let end = 0;\n    for (const i in this.messages) {\n      if (this.messages[i].expireTime > now) {\n        this.messages[end] = this.messages[i];\n        end++;\n      }\n    }\n    this.messages = this.messages.slice(0, end);\n  }\n\n  update(time, delta) {\n    // this is stupid, but I can't find a better way.\n    this.text.setX(this.player.x);\n    this.text.setY(this.player.y + 45);\n\n    if (this.messages.length > 0) {\n      this._removeOutdatedMessage();\n    }\n\n    if (this.messages.length > 0) {\n      if (!this.messageBox) {\n        this.messageBox = this.phaser.add.text(\n          this.player.x, this.player.y - 16,\n          '',\n          {\n            font: '24px monospace',\n            fill: '#000',\n            align: 'center',\n            backgroundColor: 'white',\n          }\n        ).setOrigin(0.5, 1).setDepth(99);\n      }\n      let jointMessage = '';\n      for (const i in this.messages) {\n        jointMessage += this.messages[i].message + '\\n';\n      }\n      this.messageBox.setText(jointMessage.slice(0, -1));\n      this.messageBox.setVisible(true);\n    } else {\n      if (this.messageBox) this.messageBox.setVisible(false);\n    }\n\n    if (this.messageBox) {\n      this.messageBox.setX(this.player.x);\n      this.messageBox.setY(this.player.y - 16);\n    }\n  }\n\n  destroy() {\n    this.player.destroy();\n    this.text.destroy();\n  }\n}\n\nexport class RemotePlayer extends Char {\n\n  constructor(phaser, id, name, x, y, texture, frame) {\n    super(phaser, id, name, x, y, texture, frame);\n    this.dest = {};\n  }\n\n  setProperty(key, value) {\n    switch (key) {\n      case 'texture':\n        this.texture = value;\n        this.player.setTexture(value);\n        break;\n      case 'frame':\n        this.frame = value;\n        this.player.setFrame(value);\n        break;\n      case 'name':\n        this.name = value;\n        break;\n      case 'x':\n        if (this.x !== value) this.dest.x = value;\n        // this.x = value;\n        break;\n      case 'y':\n        if (this.y !== value) this.dest.y = value;\n        // this.y = value;\n        break;\n    }\n  }\n\n  update(time, delta) {\n    // delta ~= 16ms, roughly 60 FPS\n    super.update(time, delta);\n\n    // set it higher than local speed, since we need to catch up.\n    const speed = 175 * 1.2;\n    const dest = Math.hypot(\n      this.player.x - this.dest.x, this.player.y - this.dest.y);\n    const minGap = Math.max(Const.TILE_SIZE * 0.1, speed * 0.05);\n\n    this.player.setVelocity(0);\n    if (dest < Const.TILE_SIZE * 5 && dest > minGap) {\n      this.player.setVelocityX((this.dest.x - this.x) * 2);\n      this.player.setVelocityY((this.dest.y - this.y) * 2);\n      // this.player.body.velocity.normalize().scale(speed);\n    } else {\n      this.player.setX(this.dest.x);\n      this.player.setY(this.dest.y);\n    }\n    this.x = this.player.x;\n    this.y = this.player.y;\n  }\n}\n\nexport class CharDaemon {\n  constructor() {\n    this.phaser = null;\n    this.chars = {};\n  }\n\n  setPhaser(phaser) {\n    this.phaser = phaser;\n  }\n\n  create(id, name, x, y, texture, frame) {\n    if (id in this.chars) {\n      console.error(`Character ID \"${id}\" is already declared:`);\n      console.error(this.chars[id]);\n      return;\n    }\n    const char = new Char(\n      this.phaser,\n      id, name, x, y, texture, frame);\n\n    this.chars[id] = char;\n    return char;\n  }\n\n  createRemotePlayer(id, name, x, y, texture, frame) {\n    if (id in this.chars) {\n      console.error(`Character ID \"${id}\" is already declared:`);\n      console.error(this.chars[id]);\n      return;\n    }\n\n    const char = new RemotePlayer(\n      this.phaser,\n      id, name, x, y, texture, frame);\n\n    this.chars[id] = char;\n    return char;\n  }\n\n  deleteChar(id) {\n    if (id in this.chars) {\n      this.chars[id].destroy();\n      delete this.chars[id];\n    }\n  }\n\n  getChar(id) {\n    if (id in this.chars) {\n      return this.chars[id];\n    }\n    return null;\n  }\n\n  update(time, delta) {\n    for (const id in this.chars) {\n      const char = this.chars[id];\n      char.update(time, delta);\n    }\n  }\n}\n\n\nexport class StoryLineDaemon {\n  constructor(dialogDaemon) {\n    this.storyLine = null;\n    this.dialogDaemon = dialogDaemon;\n    this.missionWithDependencies = {};\n\n    DataStore.AnswerStore.listen('*', () => {\n      console.log(this);\n      for (const missionId in this.missionWithDependencies) {\n        const mission = this.storyLine[missionId];\n        if (!mission.isReady()) {\n          continue;\n        }\n        delete this.missionWithDependencies[missionId];\n\n        this._addToDialogDaemon(mission);\n      }\n    });\n  }\n\n  init(storyLine) {\n    this.storyLine = storyLine;\n    for (const missionId in this.storyLine) {\n      const mission = this.storyLine[missionId];\n\n      if (!mission.isReady()) {\n        this.missionWithDependencies[missionId] = mission;\n        continue;\n      }\n\n      this._addToDialogDaemon(mission);\n    }\n    console.log('not enabled missions: ', this.missionWithDependencies);\n  }\n\n  _addToDialogDaemon(mission) {\n      const key = mission.firstStep;\n      const firstStep = mission.steps[key];\n\n      const id = `${mission.id}/${firstStep.id}`;\n      this.dialogDaemon.add(id, firstStep);\n  }\n}\n\nconst _RE_PLAYER = /\\$player/;\n\nexport class DialogDaemon {\n  constructor(charDaemon) {\n    this.charDaemon = charDaemon;\n    this.dialogs = {};\n    this.hasOnGoingDialog = false;\n    this.dialogToTrigger = [];\n  }\n\n  showHint() {\n    let message = '';\n    for (const key in this.dialogs) {\n      const dialog = this.dialogs[key];\n      console.log(dialog);\n      message += `<h3>${dialog.dialog.missionStep.title}</h3>`;\n      message += `<p>${dialog.dialog.missionStep.description}</p>`;\n    }\n    if (!message) {\n      message = '沒有任務!';\n    }\n    bootbox.alert({\n      title: '任務列表',\n      message: message,\n    });\n  }\n\n  getDialog(dialogId) {\n    if (dialogId in this.dialogs) {\n      return this.dialogs[dialogId];\n    }\n    return null;\n  }\n\n  showDialog(iterator) {\n    const item = iterator.getCurrentDialogItem();\n    if (!item) {\n      this.doneDialog(iterator);\n      return;\n    }\n\n    this.hasOnGoingDialog = true;\n    const me = this.charDaemon.getChar('player');\n    const talker = item.name.replace(_RE_PLAYER, me.name);\n\n    if (item instanceof StoryLine.DialogItemLine) {\n      const content = item.line.replace(_RE_PLAYER, me.name);\n      bootbox.alert({\n        title: talker,\n        message: content,\n        callback: () => {\n          this.hasOnGoingDialog = false;\n          const next = iterator.nextDialogItem();\n          if (next) {\n            this.showDialog(iterator);\n          } else {\n            this.doneDialog(iterator);\n          }\n        }\n      });\n    } else if (item instanceof StoryLine.DialogItemSelect) {\n      const question = item.question.replace(_RE_PLAYER, me.name);\n      const inputOptions = [];\n\n      for (const idx in item.choices) {\n        const text = item.choices[idx].text;\n        inputOptions.push({\n          text: text.replace(_RE_PLAYER, me.name),\n          value: idx,\n        });\n      }\n\n      bootbox.prompt({\n        title: talker,\n        message: question,\n        inputType: 'select',\n        onEscape: false,\n        backdrop: true,\n        inputOptions: inputOptions,\n        callback: result => {\n          if (result === null) {\n            return false;\n          }\n          this.hasOnGoingDialog = false;\n          const next = iterator.nextDialogItem(result);\n          if (next) {\n            this.showDialog(iterator);\n          } else {\n            this.doneDialog(iterator);\n          }\n          return true;\n        }\n      });\n    } else if (item instanceof StoryLine.DialogItemPrompt) {\n      const question = item.question.replace(_RE_PLAYER, me.name);\n      bootbox.prompt({\n        title: talker,\n        message: question,\n        inputType: 'text',\n        onEscape: false,\n        backdrop: true,\n        callback: result => {\n          if (!result) {\n            return false;\n          }\n          this.hasOnGoingDialog = false;\n          const next = iterator.nextDialogItem(result);\n          if (next) {\n            this.showDialog(iterator);\n          } else {\n            this.doneDialog(iterator);\n          }\n          return true;\n        }\n      });\n    } else if (item instanceof StoryLine.DialogItemMessage) {\n      const message = item.message.replace(_RE_PLAYER, me.name);\n      bootbox.alert({\n        title: \"\",\n        message: message,\n        callback: () => {\n          this.hasOnGoingDialog = false;\n          const next = iterator.nextDialogItem();\n          if (next) {\n            this.showDialog(iterator);\n          } else {\n            this.doneDialog(iterator);\n          }\n        }\n      });\n    } else if (item instanceof StoryLine.DialogItemIframe) {\n      const style = item.style || \"\";\n      const message = `\n      <iframe\n        id='dialog-iframe'\n        class=\"dialog-iframe\"\n        src=\"${item.url}\"\n        style=\"${style}\" ></iframe>`;\n      bootbox.dialog({\n        message,\n        size: 'large',\n        centerVertical: true,\n        closeButton: true,\n        // callback: this won't be called in \"dialog\"\n        onShown: () => {\n          const iframe = document.getElementById('dialog-iframe');\n          console.log(iframe);\n        },\n        onHidden: () => {\n          // this function is called when user press \"x\" to close the dialog.\n          console.log('on hidden');\n        }\n      });\n      // We can use iframe.contentWindow.postMessage()\" to send a message to\n      // iframe.  And use window.addEventListener('message', e => { ... }) to\n      // receive the event.  (and vice versa)\n    }\n  }\n\n  recordDone(recordKey) {\n    DataStore.AnswerStore.setAndNotify(recordKey, \"true\");\n    DataStore.RemoteStore.increase(`MISSION/${recordKey}`);\n  }\n\n  doneDialog(iterator) {\n    const dialog = iterator.dialog;\n    const missionStep = dialog.missionStep;\n    const mission = missionStep.mission;\n\n    this.remove(`${mission.id}/${missionStep.id}`);\n    this.recordDone(`${mission.id}/${missionStep.id}/done`);\n\n    const nextStepKey = iterator.nextStep;\n    if (!nextStepKey) {\n      return;\n    }\n\n    console.log('nextStepKey: ', nextStepKey);\n\n    const nextStep = mission.steps[nextStepKey];\n    if (!nextStep) return;\n    this.add(`${mission.id}/${nextStep.id}`, nextStep);\n  }\n\n  moveTo(where) {\n    const me = this.charDaemon.getChar('player');\n    if (where in PhaserWrapper.mapObjects) {\n      const loc = PhaserWrapper.mapObjects[where];\n      me.player.x = loc.x;\n      me.player.y = loc.y;\n    }\n  }\n\n  startDialog(dialogId) {\n    if (this.hasOnGoingDialog) {\n      console.warn(`There is an on-going dialog, cannot start a new one`);\n      return;\n    }\n\n    const tuple = this.getDialog(dialogId);\n    if (tuple === null) {\n      console.error(`No such dialog: ${dialogId}`);\n      return;\n    }\n\n    console.info(`startDialog: ${dialogId}`, tuple.dialog);\n\n    const {dialog} = tuple;\n\n    if (dialog.missionStep.moveTo) {\n      this.moveTo(dialog.missionStep.moveTo);\n    }\n\n    const iterator = dialog.getIterator();\n    this.showDialog(iterator);\n  }\n\n  checkDialogToTrigger(me) {\n    if (this.hasOnGoingDialog) return null;\n\n    for (const idx in this.dialogToTrigger) {\n      const {dialogId} = this.dialogToTrigger[idx];\n      this.dialogToTrigger.shift();\n      return dialogId;\n    }\n\n    for (const dialogId in this.dialogs) {\n      const {locationId} = this.dialogs[dialogId];\n      if (locationId && (locationId in PhaserWrapper.mapObjects)) {\n        const loc = PhaserWrapper.mapObjects[locationId];\n        if (Math.hypot(loc.x - me.x, loc.y - me.y) < 2 * Const.TILE_SIZE) {\n          console.log('Will trigger dialog', dialogId, 'because of location');\n          return dialogId;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  findNearbyDialog(me) {\n    for (const dialogId in this.dialogs) {\n      const {npcId} = this.dialogs[dialogId];\n      if (npcId) {\n        const npc = this.charDaemon.getChar(npcId);\n\n        if (Math.hypot(npc.x - me.x, npc.y - me.y) < 2 * Const.TILE_SIZE) {\n          return dialogId;\n        }\n      }\n    }\n    return null;\n  }\n\n  add(dialogId, step) {\n    const dialog = step.dialog;\n    const npcId = step.npcId;\n    const locationId = step.locationId;\n\n    console.log(`dialogId: ${dialogId}, npcId: ${npcId}, loc: ${locationId}`);\n\n    if (this.getDialog(dialogId) !== null) {\n      console.error(`Dialog ${dialogId} already exists.`);\n      return;\n    }\n\n    if (step.npcId !== undefined) {\n      const npc = this.charDaemon.getChar(npcId);\n      if (null === npc) {\n        console.error(`NPC ${npcId} doesn't exist.`);\n        return;\n      }\n      npc.showMissionMark(true);\n    } else if (step.locationId !== undefined) {\n      if (!(locationId in PhaserWrapper.mapObjects)) {\n        console.error(`Location ${locationId} doesn't exist.`);\n        return;\n      }\n    } else {\n      console.warn(`adding ${dialogId} to dialogToTrigger`);\n      // trigger this in next frame\n      this.dialogToTrigger.push({\n        dialogId,\n        dialog,\n      });\n    }\n\n    this.dialogs[dialogId] = {\n      npcId: npcId,\n      locationId: locationId,\n      dialog: dialog,\n    };\n    return this.dialogs[dialogId];\n  }\n\n  remove(dialogId) {\n    const tuple = this.getDialog(dialogId);\n    if (null === tuple) {\n      return;\n    }\n\n    const {npcId} = tuple;\n    const npc = this.charDaemon.getChar(npcId);\n    if (npc !== null) {\n      npc.showMissionMark(false);\n    }\n\n    delete this.dialogs[dialogId];\n  }\n}\n\nexport const charDaemon = new CharDaemon();\nexport const dialogDaemon = new DialogDaemon(charDaemon);\nexport const storyLineDaemon = new StoryLineDaemon(dialogDaemon);\n\nwindow.charDaemon = charDaemon;\n","import * as Hero from './hero.js';\nimport * as DataStore from './data_store.js';\nimport * as StoryLine from './story_line.js';\n\nexport var tileMap;\n\nexport var mapObjects = {};\n\n/*\n * tilemapTiledJSON: string, path to tilemap JSON file.\n * storylineJSON: string, path to storyline JSON file.\n */\nexport function CreateGame({\n    tilemapTiledJSON, storylineJSON, connection, npcList,\n    postBootCallback}) {\n  const WINDOW_WIDTH = window.innerWidth;\n  const WINDOW_HEIGHT = window.innerHeight;\n  const DEPTH_BELOW_LAYER = 0;\n  const DEPTH_WORLD_LAYER = 10;\n  const DEPTH_ABOVE_LAYER = 20;\n\n  let showDebug = false;\n  let cursors;\n  let sprite;\n  let char;\n\n  function preload() {\n    this.load.setPath('assets/');\n    this.load.image(\"tiles\", \"tiles/world.png\");\n    this.load.tilemapTiledJSON(\"map\", tilemapTiledJSON);\n\n    // An atlas is a way to pack multiple images together into one texture. I'm\n    // using it to load all the player animations (walking left, walking right,\n    // etc.) in one image. For more info see:\n    // https://labs.phaser.io/view.html?src=src/animation/texture%20atlas%20animation.js\n    // If you don't use an atlas, you can do the same thing with a spritesheet,\n    // see:\n    // https://labs.phaser.io/view.html?src=src/animation/single%20sprite%20sheet.js\n    this.load.atlas(\"atlas\", \"atlas/atlas.png\", \"atlas/atlas.json\");\n  }\n\n  function create() {\n    const map = this.make.tilemap({ key: \"map\" });\n\n    // Parameters are the name you gave the tileset in Tiled and then the key of\n    // the tileset image in Phaser's cache (i.e. the name you used in preload)\n    const tileset = map.addTilesetImage(\"world\", \"tiles\");\n\n    // Parameters: layer name (or index) from Tiled, tileset, x, y\n    const belowLayer = map.createStaticLayer(\"Below Player\", tileset, 0, 0);\n    const worldLayer = map.createStaticLayer(\"World\", tileset, 0, 0);\n    const aboveLayer = map.createStaticLayer(\"Above Player\", tileset, 0, 0);\n\n    worldLayer.setCollisionByProperty({ collides: true });\n\n    // By default, everything gets depth sorted on the screen in the order we\n    // created things. Here, we want the \"Above Player\" layer to sit on top of\n    // the player, so we explicitly give it a depth.  Higher depths will sit on\n    // top of lower depth objects.\n    belowLayer.setDepth(DEPTH_BELOW_LAYER);\n    worldLayer.setDepth(DEPTH_WORLD_LAYER);\n    aboveLayer.setDepth(DEPTH_ABOVE_LAYER);\n\n    window.objectLayer = map.getObjectLayer('Objects');\n    // Object layers in Tiled let you embed extra info into a map - like a spawn\n    // point or custom collision shapes.\n    map.getObjectLayer('Objects').objects.forEach(\n      obj => {mapObjects[obj.name] = obj});\n\n    this.charDaemon = Hero.charDaemon;\n    this.charDaemon.setPhaser(this);\n\n    if (npcList) {\n      for (const npcId in npcList) {\n        const {name, texture, frame} = npcList[npcId];\n        if (npcId in mapObjects) {\n          const point = mapObjects[npcId];\n          this.charDaemon.create(npcId, name, point.x, point.y, texture, frame);\n        }\n      }\n    }\n\n    const home = mapObjects['HOME'];\n    char = this.charDaemon.create(\n      'player', '???', home.x, home.y, 'atlas', 'misa-front');\n    sprite = char.player;\n\n    // Watch the player and worldLayer for collisions, for the duration of the\n    // scene:\n    const group = this.physics.add.group();\n\n    for (const id in this.charDaemon.chars) {\n      if (this.charDaemon.chars.hasOwnProperty(id)) {\n        const p = this.charDaemon.chars[id].player;\n        group.add(p);\n        // I don't know why, but I can't do this in Char.makeContainer function.\n        // And we must not set player as immovable.\n        if (id !== 'player') {\n          p.setImmovable(true);\n        }\n      }\n    }\n\n    this.physics.add.collider(group, group);\n    this.physics.add.collider(group, worldLayer);\n\n    this.dialogDaemon = Hero.dialogDaemon;\n\n    // TODO(stimim): properly load game status\n    DataStore.AnswerStore.clearAll();\n\n    StoryLine.loadStoryLine(storylineJSON).then(\n      (storyLine) => {\n        this.storyLineDaemon = Hero.storyLineDaemon;\n        this.storyLineDaemon.init(storyLine);\n      }\n    );\n\n    DataStore.AnswerStore.listen('player_name', (e) => {\n      char.name = DataStore.AnswerStore.get('player_name');\n    });\n    // Create the player's walking animations from the texture atlas. These are\n    // stored in the global animation manager so any sprite can access them.\n    const anims = this.anims;\n    anims.create({\n      key: \"misa-left-walk\",\n      frames: anims.generateFrameNames(\n        \"atlas\", { prefix: \"misa-left-walk.\", start: 0, end: 3, zeroPad: 3 }),\n      frameRate: 10,\n      repeat: -1\n    });\n    anims.create({\n      key: \"misa-right-walk\",\n      frames: anims.generateFrameNames(\n        \"atlas\", { prefix: \"misa-right-walk.\", start: 0, end: 3, zeroPad: 3 }),\n      frameRate: 10,\n      repeat: -1\n    });\n    anims.create({\n      key: \"misa-front-walk\",\n      frames: anims.generateFrameNames(\n        \"atlas\", { prefix: \"misa-front-walk.\", start: 0, end: 3, zeroPad: 3 }),\n      frameRate: 10,\n      repeat: -1\n    });\n    anims.create({\n      key: \"misa-back-walk\",\n      frames: anims.generateFrameNames(\n        \"atlas\", { prefix: \"misa-back-walk.\", start: 0, end: 3, zeroPad: 3 }),\n      frameRate: 10,\n      repeat: -1\n    });\n\n    const camera = this.cameras.main;\n    camera.startFollow(sprite);\n    camera.setBounds(0, 0, map.widthInPixels, map.heightInPixels);\n\n    cursors = this.input.keyboard.createCursorKeys();\n    const enterKey = this.input.keyboard.addKey(\n      Phaser.Input.Keyboard.KeyCodes.ENTER);\n    enterKey.on('down',(key, event) => {\n      if (this.dialogDaemon.hasOnGoingDialog) return;\n      const dialogId = this.dialogDaemon.findNearbyDialog(sprite);\n      if (dialogId !== null) {\n        this.dialogDaemon.startDialog(dialogId);\n      }\n    });\n\n    // Help text that has a \"fixed\" position on the screen\n    if($(\"#joystick\").css(\"display\") == \"block\") {\n      this.add\n        .text(16, 16, 'Use joysticks to move\\nPress the stick to interact', {\n          font: \"18px monospace\",\n          fill: \"#000000\",\n          padding: { x: 20, y: 10 },\n          backgroundColor: \"#ffffff\"\n        })\n        .setScrollFactor(0)\n        .setDepth(30);\n    }\n    else {\n      this.add\n        .text(16, 16, 'Arrow keys to move\\nPress \"Enter\" to interact', {\n          font: \"18px monospace\",\n          fill: \"#000000\",\n          padding: { x: 20, y: 10 },\n          backgroundColor: \"#ffffff\"\n        })\n        .setScrollFactor(0)\n        .setDepth(30);\n    }\n    // Debug graphics\n    this.input.keyboard.once(\"keydown_D\", event => {\n      // Turn on physics debugging to show player's hitbox\n      this.physics.world.createDebugGraphic();\n\n      // Create worldLayer collision graphic above the player, but below the\n      // help text\n      const graphics = this.add\n        .graphics()\n        .setAlpha(0.75)\n        .setDepth(20);\n      worldLayer.renderDebug(graphics, {\n        tileColor: null,\n        collidingTileColor: new Phaser.Display.Color(243, 134, 48, 255),\n        faceColor: new Phaser.Display.Color(40, 39, 37, 255),\n      });\n    });\n\n\n    // joystick\n    const stick = $(\"#joystick .touch-stick\");\n    var limit = $(\"#joystick\").width()/2;\n    var dead = 0.3;\n    var center_x = $(\"#joystick\").position().left + $(\"#joystick\").width()/2;\n    var center_y = $(\"#joystick\").position().top + $(\"#joystick\").height()/2;\n\n    function initjoystick() {\n      center_x = $(\"#joystick\").position().left + $(\"#joystick\").width()/2;\n      center_y = $(\"#joystick\").position().top + $(\"#joystick\").height()/2;\n      limit = $(\"#joystick\").width()/2;\n    }\n    $(window).on('resize', function(){\n      initjoystick();\n    });\n\n    var tap = false;\n    $(\"#joystick\").on('touchmove','.touch-stick', function(e){\n      e.preventDefault(); \n      tap = false;\n      var touch = e.originalEvent.targetTouches[0];\n      var delta_x = (touch.pageX-center_x)/limit;\n      var delta_y = (touch.pageY-center_y)/limit;\n      delta_x = Math.min(Math.max(delta_x, -1), 1);\n      delta_y = Math.min(Math.max(delta_y, -1), 1);\n      $(this).css({\"left\": `${delta_x*50 + 50}%`, \"top\": `${delta_y*50 + 50}%`});\n\n      if(Math.abs(delta_x)<dead) {\n        delta_x = 0;\n        cursors.left.isDown = false;\n        cursors.right.isDown = false;\n      }\n      if(Math.abs(delta_y)<dead) {\n        delta_y = 0;\n        cursors.up.isDown = false;\n        cursors.down.isDown = false;\n      }\n      if(Math.abs(delta_x) >= Math.abs(delta_y)) {\n        if(delta_x > 0){\n          cursors.right.isDown = true;\n          cursors.left.isDown = false;\n        } else {\n          cursors.right.isDown = false;\n          cursors.left.isDown = true;\n        }\n      } else {\n        if(delta_y < 0){\n          cursors.up.isDown = true;\n          cursors.down.isDown = false;\n        } else {\n          cursors.up.isDown = false;\n          cursors.down.isDown = true;\n        }\n      }\n    });\n    $(\"#joystick\").on('touchstart','.touch-stick', function(e) {\n      tap = true;\n    });\n    $(\"#joystick\").on('touchend','.touch-stick', () => {\n      $(\"#joystick .touch-stick\").css({\"left\": '50%', \"top\": '50%'});\n      cursors.up.isDown = false;\n      cursors.down.isDown = false;\n      cursors.left.isDown = false;\n      cursors.right.isDown = false;\n      if(tap) {\n        if (this.dialogDaemon.hasOnGoingDialog) return;\n        const dialogId = this.dialogDaemon.findNearbyDialog(sprite);\n        if (dialogId !== null) {\n          this.dialogDaemon.startDialog(dialogId);\n        }\n      }\n    });\n  }\n\n  function update(time, delta) {\n\n    // let's check if we triggered any dialogs\n    const dialogId = this.dialogDaemon.checkDialogToTrigger(sprite);\n    if (dialogId !== null) {\n      this.dialogDaemon.startDialog(dialogId);\n      return;\n    }\n\n    const speed = 175;\n    const prevVelocity = sprite.body.velocity.clone();\n\n    // Stop any previous movement from the last frame\n    sprite.body.setVelocity(0);\n\n    // Horizontal movement\n    if (cursors.left.isDown) {\n      sprite.body.setVelocityX(-speed);\n    } else if (cursors.right.isDown) {\n      sprite.body.setVelocityX(speed);\n    }\n\n    // Vertical movement\n    if (cursors.up.isDown) {\n      sprite.body.setVelocityY(-speed);\n    } else if (cursors.down.isDown) {\n      sprite.body.setVelocityY(speed);\n    }\n\n    // Normalize and scale the velocity so that player can't move faster along a\n    // diagonal\n    sprite.body.velocity.normalize().scale(speed);\n\n    // Update the animation last and give left/right animations precedence over\n    // up/down animations\n\n    if (cursors.left.isDown) {\n      sprite.anims.play(\"misa-left-walk\", true);\n    } else if (cursors.right.isDown) {\n      sprite.anims.play(\"misa-right-walk\", true);\n    } else if (cursors.up.isDown) {\n      sprite.anims.play(\"misa-back-walk\", true);\n    } else if (cursors.down.isDown) {\n      sprite.anims.play(\"misa-front-walk\", true);\n    } else {\n      sprite.anims.stop();\n\n      // If we were moving, pick and idle frame to use\n      if (prevVelocity.x < 0) sprite.setTexture(\"atlas\", \"misa-left\");\n      else if (prevVelocity.x > 0) sprite.setTexture(\"atlas\", \"misa-right\");\n      else if (prevVelocity.y < 0) sprite.setTexture(\"atlas\", \"misa-back\");\n      else if (prevVelocity.y > 0) sprite.setTexture(\"atlas\", \"misa-front\");\n    }\n\n    if (connection) {\n      connection.update(time, delta, char);\n    }\n    this.charDaemon.update(time, delta);\n  }\n\n  const config = {\n    type: Phaser.AUTO,\n    width: WINDOW_WIDTH,\n    height: WINDOW_HEIGHT,\n    parent: \"game-container\",\n    pixelArt: true,\n    physics: {\n      default: \"arcade\",\n      arcade: {\n        gravity: { y: 0 }\n      }\n    },\n    scene: {\n      preload: preload,\n      create: create,\n      update: update\n    },\n    callbacks: {\n      postBoot: postBootCallback || (() => {}),\n    }\n  };\n\n  const game = new Phaser.Game(config);\n  return game;\n}\n","/**\n * Design Doc: https://g0v.hackmd.io/4HiKmrEASa-YdQ2bqg4kHg\n */\n\nimport * as DataStore from './data_store.js';\n\n/**\n * <mission-id>:  # repeated\n *   title: <mission-title>\n *   description: <...>\n *   depend:\n *     A list of clauses.  If the list is empty, there is no dependency.\n *     Otherwise, at least one of the clauses needs to be true to trigger this\n *     mission (that is, disjunctive)\n *     - clause: a list of expressions, the clause is true if and only if all\n *     expressions are true.\n *       - expression:\n *            \"<ANSWER_STORE_KEY>\" |\n *            { \"storeKey\": \"<ANSWER_STORE_KEY>\", \"value\": \"<expected value>\" }\n *   firstStep: <step-id>\n *   steps:\n *     ...\n */\nclass Mission {\n  constructor(id, title, description, depend, firstStep) {\n    this.id = id;\n    this.title = title;\n    this.description = description;\n    this.depend = depend;\n    this.firstStep = firstStep;\n    this.steps = {};\n  }\n\n  addStep(missionStep) {\n    this.steps[missionStep.id] = missionStep;\n  }\n\n  _checkClause(clause) {\n    for (const i in clause) {\n      const expr = clause[i];\n      console.log(`condition: `, expr);\n      let key;\n      let expectedValue;\n      if (typeof(expr) === 'string') {\n        key = expr;\n      } else if (typeof(expr) === 'object') {\n        key = expr['storeKey'];\n        expectedValue = expr['value'];\n      }\n      if (!DataStore.AnswerStore.has(key)) return false;\n      if (!expectedValue) continue;\n      const actualValue = DataStore.AnswerStore.get(key);\n      if (actualValue !== expectedValue) return false;\n    }\n    return true;\n  }\n\n  isReady() {\n    console.log(`checking dependency of ${this.id}`, this.depend);\n    if (!this.depend || this.depend.length === 0) return true;\n\n    for (const idx in this.depend) {\n      let clause = this.depend[idx];\n      if (!(clause instanceof Array)) {\n        clause = [clause];\n      }\n\n      console.log(clause);\n      if (this._checkClause(clause)) {\n        console.log(`${this.id} is ready!`);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  static fromDict(missionId, dict) {\n    const title = dict['title'] || 'Unnamed Mission';\n    const description = dict['description'] || 'no description';\n    const firstStep = dict['firstStep'] || 'step-1';\n    const depend = (dict['depend'] || []).filter(d => {\n      if (typeof(d) === 'string' || d instanceof String) {\n        return true;\n      }\n      if (typeof(d) === 'object') return true;\n      console.warn(`${d} is not a string nor an object`);\n      return false;\n    });\n\n    const mission = new Mission(\n      missionId, title, description, depend, firstStep);\n\n    for (const stepId in dict['steps']) {\n      const step = MissionStep.fromDict(stepId, dict['steps'][stepId], mission);\n      mission.addStep(step);\n    }\n    return mission;\n  }\n}\n\n/**\n * <step-id>:  # repeated\n *   title: <step-title>\n *   description: <...>\n *   nextStep: <step-id>  # the default next step\n *   npcId: <npc-id>  # whom to find to trigger the dialog of this step.\n *                    # NPC can be an object (e.g. a box).\n *   locationId: <location-id>  # where to go to trigger the dialog.\n *   dialog:\n *     - name: \"NPC name\" or $player  # who is talking\n *       line: \"hello, $player\"\n *       id: <line-id>  # optional\n *       nextLine: <line-id>  # optional: jump to another dialog if we don't\n *                             # want to fallthrough.  \"$EOD\" means \"end of\n *                             # dialog\"\n *     - name: \"NPC name\" or $player\n *       question: \"Red pill or blue pill?\"\n *       choices:\n *         - text: \"Red\"\n *           nextLine: <line-id>  # optional\n *         - text: \"Blue\"\n *           nextLine: <line-id>  # optional\n */\nclass MissionStep {\n  constructor({\n    id, title, description, nextStep, npcId, locationId, dialog, mission,\n    moveTo}) {\n\n    this.id = id;\n    this.title = title || 'Unnamed Step';\n    this.description = description || '...';\n    this.nextStep = nextStep;\n    this.npcId = npcId;\n    this.locationId = locationId;\n    this.dialog = dialog;\n    this.mission = mission;\n    this.moveTo = moveTo;\n  }\n\n  static fromDict(stepId, dict, mission) {\n    const d = {id: stepId, mission: mission, ...dict};\n    const missionStep = new MissionStep(d);\n\n    const dialog = Dialog.fromDict(dict['dialog'] || [], missionStep);\n    missionStep.dialog = dialog;\n    return missionStep;\n  }\n}\n\n/**\n *   dialog:\n *     - name: \"NPC name\" or $player  # who is talking\n *       line: \"hello, $player\"\n *       id: <line-id>  # optional\n *       nextLine: <line-id>  # optional: jump to another dialog if we don't\n *                             # want to fallthrough.  \"$EOD\" means \"end of\n *                             # dialog\"\n *     - name: \"NPC name\" or $player\n *       question: \"Red pill or blue pill?\"\n *       choices:\n *         - text: \"Red\"\n *           nextLine: <line-id>  # optional\n *         - text: \"Blue\"\n *           nextLine: <line-id>  # optional\n */\nclass Dialog {\n  constructor(missionStep) {\n    this.missionStep = missionStep;\n    this.dialogItems = [];\n    this.dialogIdMap = {};\n  }\n\n  addDialogItem(dialogItem) {\n    this.dialogItems.push(dialogItem);\n    if (dialogItem.id !== undefined) {\n      this.dialogIdMap[dialogItem.id] = this.dialogItems.length - 1;\n    }\n  }\n\n  getIterator() {\n    return new DialogIterator(this, this.missionStep.nextStep);\n  }\n\n  static fromDict(list, missionStep) {\n    const dialog = new Dialog(missionStep);\n    for (const dict of list) {\n      const dialogItem = DialogItem.fromDict(dict);\n      dialog.addDialogItem(dialogItem);\n    }\n    return dialog;\n  }\n}\n\n\nclass DialogIterator {\n  constructor(dialog, nextStep) {\n    this.dialog = dialog;\n    this.currentIndex = 0;\n    this.nextStep = nextStep;\n  }\n\n  getCurrentDialogItem() {\n    const item = this.dialog.dialogItems[this.currentIndex];\n    if (item && item.nextStep) this.nextStep = item.nextStep;\n    return item;\n  }\n\n  nextDialogItem(answer=undefined) {\n    const dialogItem = this.dialog.dialogItems[this.currentIndex];\n    let nextIndex = this.currentIndex + 1;\n    if (dialogItem.nextLine !== undefined) {\n      nextIndex = this.dialog.dialogIdMap[dialogItem.nextLine];\n    }\n\n    if (dialogItem instanceof DialogItemSelect) {\n      if (answer === undefined) {\n        console.warn('This is a multiple choice question, but no selected ' +\n          'answer. Default to the first answer.')\n        answer = 0;\n      }\n\n      if (dialogItem.choices[answer].nextLine !== undefined) {\n        const nextLine = dialogItem.choices[answer].nextLine;\n        nextIndex = this.dialog.dialogIdMap[nextLine];\n      }\n    }\n\n    if (dialogItem instanceof DialogItemPrompt) {\n      if (dialogItem.storeKey) {\n        DataStore.AnswerStore.setAndNotify(dialogItem.storeKey, answer);\n      }\n    }\n    if (dialogItem instanceof DialogItemSelect) {\n      const value = dialogItem.choices[answer].value || answer;\n      if (dialogItem.storeKey) {\n        DataStore.AnswerStore.setAndNotify(dialogItem.storeKey, value);\n        DataStore.RemoteStore.increase(`USER_RESPONSE/${dialogItem.storeKey}`);\n      }\n    }\n\n    console.info(\n        `${this.dialog.missionStep.id} The next line is: ${nextIndex}`);\n    this.currentIndex = nextIndex;\n    return this.getCurrentDialogItem();\n  }\n}\n\n/**\n * Properties:\n *   - id: (optional) an id to find this line.\n *   - name: Who is talking, can be \"$player\"\n *   - nextLine: (optional) jump to another dialog if we don't want to\n *               fallthrough.  Use \"$EOD\" to end the dialog.\n */\nclass DialogItem {\n  constructor(name, {id: id, nextLine: nextLine}) {\n    this.name = name;\n    this.id = id;\n    this.nextLine = nextLine;\n  }\n\n  static fromDict(dict) {\n    const name = dict['name'] || 'John Doe';\n    const type = dict['type'] || 'line';\n\n    switch (type) {\n      case 'line':\n        return new DialogItemLine(name, dict);\n      case 'input.select':\n        return new DialogItemSelect(name, dict);\n      case 'input.text':\n        return new DialogItemPrompt(name, dict);\n      case 'message':\n        return new DialogItemMessage(name, dict);\n      case 'iframe':\n        return new DialogItemIframe(name, dict);\n      default:\n        console.warn('unkonwn dialog type: %s', type);\n        return new DialogItemLine(name, dict);\n    }\n  }\n}\n\n/**\n * Dialog item for a single line\n *     - name: \"NPC name\" or $player  # who is talking\n *       line: \"hello, $player\"\n *       id: <line-id>  # optional\n *       nextLine: <line-id>  # optional: jump to another dialog if we don't\n *                             # want to fallthrough.  \"$EOD\" means \"end of\n *                             # dialog\"\n */\nexport class DialogItemLine extends DialogItem {\n  constructor(name, {\n    id: id,\n    nextLine: nextLine,\n    line: line, }) {\n    super(name, {id, nextLine});\n\n    if (line === undefined) {\n      console.warn('One of `line` and `question` should be defined.');\n      line = '...';\n    }\n    this.line = line;\n  }\n\n}\n\n/**\n *     - name: \"NPC name\" or $player\n *       question: \"Red pill or blue pill?\"\n *       storeKey: 'key'  (optional) to save the answer in localStore.\n *       choices:\n *         - text: \"Red\"\n *           nextLine: <line-id>  # optional\n *         - text: \"Blue\"\n *           nextLine: <line-id>  # optional\n */\nexport class DialogItemSelect extends DialogItem {\n  constructor(name, {\n    id: id,\n    nextLine: nextLine,\n    question: question,\n    choices: choices,\n    storeKey: storeKey}) {\n\n    super(name, {id, nextLine});\n    if (question === undefined) {\n      console.warn('set default question');\n      question = 'Please select an answer.';\n    }\n    this.question = question;\n\n    if (choices === undefined || !choices) {\n      console.warn('set default choices');\n      choices = [\n        {text: 'Ok'}\n      ]\n    }\n    this.choices = choices;\n    this.storeKey = storeKey;\n  }\n}\n\n/**\n * Dialog item for an open question\n *\n *     - name: \"NPC name\" or $player\n *       question: \"What's your name?\"\n *       storeKey: 'key' (optional) to save the answer in localStore\n *\n */\nexport class DialogItemPrompt extends DialogItem {\n  constructor(name, {\n    id: id,\n    nextLine: nextLine,\n    question: question,\n    storeKey: storeKey, }) {\n    super(name, {id, nextLine});\n    if (question === undefined) {\n      console.warn('set deafult question');\n      question = 'What do you want to share?';\n    }\n    this.question = question;\n    this.storeKey = storeKey;\n  }\n}\n\nexport class DialogItemMessage extends DialogItem {\n  constructor(name, {\n    id: id,\n    nextLine: nextLine,\n    message: message}) {\n    super(name, {id, nextLine});\n    if (message === undefined) {\n      console.warn('use default message');\n      message = 'MESSAGE';\n    }\n    this.message = message;\n  }\n}\n\nexport class DialogItemIframe extends DialogItem {\n  constructor(name, {\n    id: id,\n    nextLine: nextLine,\n    url: url,\n    callback: callback,\n    style: style,}) {\n    super(name, {id, nextLine});\n\n    this.url = url;\n    this.callback = callback;\n    this.style = style;\n  }\n}\n\nexport function loadStoryLineFromObject(obj) {\n  const missions = obj['missions'];\n  const loadedMissions = {};\n  if (!missions) {\n    return loadedMissions;\n  }\n\n  for (const missionId in missions) {\n    const missionDict = missions[missionId];\n    loadedMissions[missionId] = Mission.fromDict(missionId, missionDict);\n  }\n  console.debug(loadedMissions);\n  return loadedMissions;\n}\n\nexport async function loadStoryLine(fileName) {\n  const response = await fetch(`/story-lines/${fileName}`);\n  const obj = await response.json();\n\n  return loadStoryLineFromObject(obj);\n}\n","/*! store2 - v2.12.0 - 2020-08-12\n* Copyright (c) 2020 Nathan Bubna; Licensed (MIT OR GPL-3.0) */\n;(function(window, define) {\n    var _ = {\n        version: \"2.12.0\",\n        areas: {},\n        apis: {},\n\n        // utilities\n        inherit: function(api, o) {\n            for (var p in api) {\n                if (!o.hasOwnProperty(p)) {\n                    Object.defineProperty(o, p, Object.getOwnPropertyDescriptor(api, p));\n                }\n            }\n            return o;\n        },\n        stringify: function(d) {\n            return d === undefined || typeof d === \"function\" ? d+'' : JSON.stringify(d);\n        },\n        parse: function(s, fn) {\n            // if it doesn't parse, return as is\n            try{ return JSON.parse(s,fn||_.revive); }catch(e){ return s; }\n        },\n\n        // extension hooks\n        fn: function(name, fn) {\n            _.storeAPI[name] = fn;\n            for (var api in _.apis) {\n                _.apis[api][name] = fn;\n            }\n        },\n        get: function(area, key){ return area.getItem(key); },\n        set: function(area, key, string){ area.setItem(key, string); },\n        remove: function(area, key){ area.removeItem(key); },\n        key: function(area, i){ return area.key(i); },\n        length: function(area){ return area.length; },\n        clear: function(area){ area.clear(); },\n\n        // core functions\n        Store: function(id, area, namespace) {\n            var store = _.inherit(_.storeAPI, function(key, data, overwrite) {\n                if (arguments.length === 0){ return store.getAll(); }\n                if (typeof data === \"function\"){ return store.transact(key, data, overwrite); }// fn=data, alt=overwrite\n                if (data !== undefined){ return store.set(key, data, overwrite); }\n                if (typeof key === \"string\" || typeof key === \"number\"){ return store.get(key); }\n                if (typeof key === \"function\"){ return store.each(key); }\n                if (!key){ return store.clear(); }\n                return store.setAll(key, data);// overwrite=data, data=key\n            });\n            store._id = id;\n            try {\n                var testKey = '__store2_test';\n                area.setItem(testKey, 'ok');\n                store._area = area;\n                area.removeItem(testKey);\n            } catch (e) {\n                store._area = _.storage('fake');\n            }\n            store._ns = namespace || '';\n            if (!_.areas[id]) {\n                _.areas[id] = store._area;\n            }\n            if (!_.apis[store._ns+store._id]) {\n                _.apis[store._ns+store._id] = store;\n            }\n            return store;\n        },\n        storeAPI: {\n            // admin functions\n            area: function(id, area) {\n                var store = this[id];\n                if (!store || !store.area) {\n                    store = _.Store(id, area, this._ns);//new area-specific api in this namespace\n                    if (!this[id]){ this[id] = store; }\n                }\n                return store;\n            },\n            namespace: function(namespace, singleArea) {\n                if (!namespace){\n                    return this._ns ? this._ns.substring(0,this._ns.length-1) : '';\n                }\n                var ns = namespace, store = this[ns];\n                if (!store || !store.namespace) {\n                    store = _.Store(this._id, this._area, this._ns+ns+'.');//new namespaced api\n                    if (!this[ns]){ this[ns] = store; }\n                    if (!singleArea) {\n                        for (var name in _.areas) {\n                            store.area(name, _.areas[name]);\n                        }\n                    }\n                }\n                return store;\n            },\n            isFake: function(){ return this._area.name === 'fake'; },\n            toString: function() {\n                return 'store'+(this._ns?'.'+this.namespace():'')+'['+this._id+']';\n            },\n\n            // storage functions\n            has: function(key) {\n                if (this._area.has) {\n                    return this._area.has(this._in(key));//extension hook\n                }\n                return !!(this._in(key) in this._area);\n            },\n            size: function(){ return this.keys().length; },\n            each: function(fn, fill) {// fill is used by keys(fillList) and getAll(fillList))\n                for (var i=0, m=_.length(this._area); i<m; i++) {\n                    var key = this._out(_.key(this._area, i));\n                    if (key !== undefined) {\n                        if (fn.call(this, key, this.get(key), fill) === false) {\n                            break;\n                        }\n                    }\n                    if (m > _.length(this._area)) { m--; i--; }// in case of removeItem\n                }\n                return fill || this;\n            },\n            keys: function(fillList) {\n                return this.each(function(k, v, list){ list.push(k); }, fillList || []);\n            },\n            get: function(key, alt) {\n                var s = _.get(this._area, this._in(key)),\n                    fn;\n                if (typeof alt === \"function\") {\n                    fn = alt;\n                    alt = null;\n                }\n                return s !== null ? _.parse(s, fn) :\n                    alt != null ? alt : s;\n            },\n            getAll: function(fillObj) {\n                return this.each(function(k, v, all){ all[k] = v; }, fillObj || {});\n            },\n            transact: function(key, fn, alt) {\n                var val = this.get(key, alt),\n                    ret = fn(val);\n                this.set(key, ret === undefined ? val : ret);\n                return this;\n            },\n            set: function(key, data, overwrite) {\n                var d = this.get(key);\n                if (d != null && overwrite === false) {\n                    return data;\n                }\n                return _.set(this._area, this._in(key), _.stringify(data), overwrite) || d;\n            },\n            setAll: function(data, overwrite) {\n                var changed, val;\n                for (var key in data) {\n                    val = data[key];\n                    if (this.set(key, val, overwrite) !== val) {\n                        changed = true;\n                    }\n                }\n                return changed;\n            },\n            add: function(key, data) {\n                var d = this.get(key);\n                if (d instanceof Array) {\n                    data = d.concat(data);\n                } else if (d !== null) {\n                    var type = typeof d;\n                    if (type === typeof data && type === 'object') {\n                        for (var k in data) {\n                            d[k] = data[k];\n                        }\n                        data = d;\n                    } else {\n                        data = d + data;\n                    }\n                }\n                _.set(this._area, this._in(key), _.stringify(data));\n                return data;\n            },\n            remove: function(key, alt) {\n                var d = this.get(key, alt);\n                _.remove(this._area, this._in(key));\n                return d;\n            },\n            clear: function() {\n                if (!this._ns) {\n                    _.clear(this._area);\n                } else {\n                    this.each(function(k){ _.remove(this._area, this._in(k)); }, 1);\n                }\n                return this;\n            },\n            clearAll: function() {\n                var area = this._area;\n                for (var id in _.areas) {\n                    if (_.areas.hasOwnProperty(id)) {\n                        this._area = _.areas[id];\n                        this.clear();\n                    }\n                }\n                this._area = area;\n                return this;\n            },\n\n            // internal use functions\n            _in: function(k) {\n                if (typeof k !== \"string\"){ k = _.stringify(k); }\n                return this._ns ? this._ns + k : k;\n            },\n            _out: function(k) {\n                return this._ns ?\n                    k && k.indexOf(this._ns) === 0 ?\n                        k.substring(this._ns.length) :\n                        undefined : // so each() knows to skip it\n                    k;\n            }\n        },// end _.storeAPI\n        storage: function(name) {\n            return _.inherit(_.storageAPI, { items: {}, name: name });\n        },\n        storageAPI: {\n            length: 0,\n            has: function(k){ return this.items.hasOwnProperty(k); },\n            key: function(i) {\n                var c = 0;\n                for (var k in this.items){\n                    if (this.has(k) && i === c++) {\n                        return k;\n                    }\n                }\n            },\n            setItem: function(k, v) {\n                if (!this.has(k)) {\n                    this.length++;\n                }\n                this.items[k] = v;\n            },\n            removeItem: function(k) {\n                if (this.has(k)) {\n                    delete this.items[k];\n                    this.length--;\n                }\n            },\n            getItem: function(k){ return this.has(k) ? this.items[k] : null; },\n            clear: function(){ for (var k in this.items){ this.removeItem(k); } }\n        }// end _.storageAPI\n    };\n\n    var store =\n        // safely set this up (throws error in IE10/32bit mode for local files)\n        _.Store(\"local\", (function(){try{ return localStorage; }catch(e){}})());\n    store.local = store;// for completeness\n    store._ = _;// for extenders and debuggers...\n    // safely setup store.session (throws exception in FF for file:/// urls)\n    store.area(\"session\", (function(){try{ return sessionStorage; }catch(e){}})());\n    store.area(\"page\", _.storage(\"page\"));\n\n    if (typeof define === 'function' && define.amd !== undefined) {\n        define('store2', [], function () {\n            return store;\n        });\n    } else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = store;\n    } else {\n        // expose the primary store fn to the global object and save conflicts\n        if (window.store){ _.conflict = window.store; }\n        window.store = store;\n    }\n\n})(this, this && this.define);\n","import * as PhaserWrapper from './phaser_wrapper.js';\nimport * as Hero from './hero.js';\n\nconst npcList = {\n  'speaker-npc': {\n    name: '演講者',\n    texture: 'atlas',\n    frame: 'misa-down',\n  },\n  'shop-clerk-npc': {\n    name: '店員',\n    texture: 'atlas',\n    frame: 'misa-down',\n  },\n  'classmate-npc': {\n    name: '同學',\n    texture: 'atlas',\n    frame: 'misa-left',\n  },\n  'academic-affairs-officer-npc': {\n    name: '教務處職員',\n    texture: 'atlas',\n    frame: 'misa-left',\n  },\n  'department-officer-npc': {\n    name: '系辦公室職員',\n    texture: 'atlas',\n    frame: 'misa-right',\n  },\n  'home-robot-npc': {\n    name: '家用機器人',\n    texture: 'atlas',\n    frame: 'misa-right'\n  }\n};\nPhaserWrapper.CreateGame({\n  tilemapTiledJSON: 'maps/idystopia.json',\n  storylineJSON: 'regular.json',\n  npcList});\n\n$( '#mission-panel' ).click( () => {\n  Hero.dialogDaemon.showHint();\n});\n"],"sourceRoot":""}